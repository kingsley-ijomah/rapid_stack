require "httparty"

module ExternalApi
  class <%= pascalCaseName %>Service
    BASE_URL = "<%= baseUrl %>"
    ENDPOINT = "<%= endpoint %>"
    API_KEY = ENV["<%= apiKeyEnvVar %>"]

    def self.<%= camelCaseName %>(query)
      query_params = {
        api_key: API_KEY,
        query: query
      }
      <% if (queryParams && queryParams.length > 0) { %>
      # Add any additional query parameters from the API URL
      <% queryParams.forEach(function(param) { %>
      query_params[:<%= param %>] = nil
      <% }); %>
      <% } %>

      response = HTTParty.get(
        "#{BASE_URL}#{ENDPOINT}",
        query: query_params
      )

      if response.success?
        response.parsed_response
      else
        raise ExternalApi::Error, "<%= pascalCaseName %> API request failed: #{response.code}"
      end
    end
  end
end 