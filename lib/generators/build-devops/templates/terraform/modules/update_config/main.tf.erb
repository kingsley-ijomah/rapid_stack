terraform {
  required_providers {
    null = {
      source = "hashicorp/null"
      version = "~> 3.0"
    }
  }
}

resource "null_resource" "update_config" {
  provisioner "local-exec" {
    command = <<-EOT
      CONFIG_PATH="$HOME/.rapid_stack/config.yml"
      if [ ! -f "$CONFIG_PATH" ]; then
        echo "Config file not found at: $CONFIG_PATH" >&2
        exit 1
      fi
      
      # Use sed to update the remote_machine field
      sed -i '' "s/remote_machine:.*/remote_machine: ${var.floating_ip}/" "$CONFIG_PATH"
      echo "Updated remote_machine in config file with IP: ${var.floating_ip}" >&2
    EOT
    interpreter = ["/bin/bash", "-c"]
  }
}